{% set name = "visp" %}
{% set version = "3.5.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/lagadic/visp/archive/refs/tags/v{{ version }}.tar.gz
  sha256: 494a648b2570da2a200ba326ed61a14e785eb9ee08ef12d3ad178b2f384d3d30

build:
  number: 0
  skip: true  # [osx]
  run_exports:
    - {{ pin_subpackage(name, max_pin='x.x') }}

requirements:
  build:
    - {{ compiler('cxx') }}
    - cmake
    - clang # [win]
    - make # [not win]
    - ninja # [win]
    - {{ cdt('mesa-libgl-devel') }}  # [linux]
    - {{ cdt('mesa-dri-drivers') }}  # [linux]
    - {{ cdt('libselinux') }}  # [linux]
    - {{ cdt('libxdamage') }}  # [linux]
    - {{ cdt('libxxf86vm') }}  # [linux]
    - {{ cdt('libxext') }}     # [linux]
  host:
    - _openmp_mutex  # [linux]
    - xorg-libx11    # [unix]
    - xorg-libxfixes  # [linux]
    - libopencv
    - eigen
    - libjpeg-turbo
    - libpng
    - libxml2
    - libdc1394 >=2.2.6 # [not win]
    - ogre >=1.9.0,<=1.10.12
    - mkl-devel
    - librealsense # [not win]
  run:
    - mkl

test:
  commands:
    - test -f $PREFIX/lib/lib{{ name }}_ar${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_blob${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_core${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_detection${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_gui${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_io${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_klt${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_mbt${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_me${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_robot${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_sensor${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_tt${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_tt_mi${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_vision${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_visual_features${SHLIB_EXT}  # [not win]
    - test -f $PREFIX/lib/lib{{ name }}_vs${SHLIB_EXT}  # [not win]

about:
  home: https://visp.inria.fr/
  summary: 'A cross-platform library for prototyping and developing applications using visual tracking and visual servoing technic.'
  license: GPL-2.0-only
  license_family: GPL
  license_file: LICENSE.txt
  doc_url: https://visp-doc.inria.fr/doxygen/visp-{{ version }}/
  dev_url: https://github.com/lagadic/visp

extra:
  recipe-maintainers:
    - olivier-roussel
    - fspindle