{% set version = '0.4.0' %}
{% set posix = 'm2-' if win else '' %}

package:
  name: r-luz
  version: {{ version|replace("-", "_") }}

source:
  url:
    - {{ cran_mirror }}/src/contrib/luz_{{ version }}.tar.gz
    - {{ cran_mirror }}/src/contrib/Archive/luz/luz_{{ version }}.tar.gz
  sha256: ff3653f97224a971683879f24580851651d21cf8ff87af40e0b36d09b381e10a

build:
  number: 0
  noarch: generic
  rpaths:
    - lib/R/lib/
    - lib/
  missing_dso_whitelist:
    - '*/R.dll'        # [win]
    - '*/Rblas.dll'    # [win]
    - '*/Rlapack.dll'  # [win]

requirements:
  build:
    - {{ posix }}zip               # [win]
    - cross-r-base {{ r_base }}    # [build_platform != target_platform]
  host:
    - r-base
    - r-r6
    - r-cli
    - r-coro
    - r-ellipsis
    - r-fs
    - r-generics
    - r-glue
    - r-magrittr
    - r-prettyunits
    - r-progress
    - r-purrr
    - r-rlang >=1.0.0
    - r-torch >=0.9.0
    - r-zeallot
  run:
    - r-base
    - r-r6
    - r-cli
    - r-coro
    - r-ellipsis
    - r-fs
    - r-generics
    - r-glue
    - r-magrittr
    - r-prettyunits
    - r-progress
    - r-purrr
    - r-rlang >=1.0.0
    - r-torch >=0.9.0
    - r-zeallot

test:
  commands:
    - $R -e "library('luz')"           # [not win]
    - "\"%R%\" -e \"library('luz')\""  # [win]

about:
  home: https://mlverse.github.io/luz/, https://github.com/mlverse/luz
  license: MIT
  summary: A high level interface for 'torch' providing utilities to reduce the the amount of
    code needed for common tasks, abstract away torch details and make the same code
    work on both the 'CPU' and 'GPU'. It's flexible enough to support expressing a large
    range of models. It's heavily inspired by 'fastai' by Howard et al. (2020) <arXiv:2002.04688>,
    'Keras' by Chollet et al. (2015) and 'PyTorch Lightning' by Falcon et al. (2019)
    <doi:10.5281/zenodo.3828935>.
  license_family: MIT
  license_file:
    - '{{ environ["PREFIX"] }}/lib/R/share/licenses/MIT'
    - LICENSE

extra:
  recipe-maintainers:
    - conda-forge/r
