{% set name = "msmtp" %}
{% set version = "1.8.27" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://marlam.de/msmtp/releases/{{ name }}-{{ version}}.tar.xz
  sha256: 94030580a63a747faa0a3b9b1b264ae355aad33a4d94b832bfeb5b21633c965e

build:
  skip: True  # [win]
  script:
    - autoreconf -ivf
    - ./configure --prefix=$PREFIX --datarootdir=$PREFIX --with-tls=gnutls --with-libidn
    # Conda libgsasl needs updated to v2.1 for --with-libgsasl
    - make
    - make install
  number: 0

requirements:
  build:
    - {{ compiler('c') }}
    - {{ stdlib('c') }}
    - autoconf
    - make
    - pkg-config
  host:
    - gnutls
    - libidn11
    # - libgsasl

test:
  commands:
    - msmtp --help
    - msmtpd --help
    - test -f $PREFIX/man/man1/msmtp.1

outputs:
  - name: {{ name }}
  - name: {{ name }}-sendmail
    build:
      skip: True  # [win]
      script:
        - ln -s msmtp $PREFIX/bin/sendmail
        - ln -s msmtp.1 $PREFIX/man/man1/sendmail.1
    requirements:
      run:
        - msmtp
    test:
      commands:
        - sendmail --help
        - test -e $PREFIX/man/man1/sendmail.1
    about:
      summary: 'Use msmtp as a sendmail alternative'
      desription: |
        Provides an alternative to the 'sendmail' tool. When sendmail is called
        it will call 'msmtp' instead.

about:
  home: https://marlam.de/msmtp/
  summary: 'msmtp is an SMTP client'
  description: |
    In the default mode, it transmits a mail to an SMTP server which takes care
    of further delivery.

    To use this program with your mail user agent (MUA), create a configuration
    file with your mail account(s) and tell your MUA to call msmtp instead of
    /usr/sbin/sendmail.
  license: GPL-3.0-or-later
  license_family: GPL
  license_file: COPYING
  dev_url: https://git.marlam.de/gitweb/?p=msmtp.git

extra:
  recipe-maintainers:
    - blmaier
