{% set name = "PyGnome" %}
{% set version = "1.1.12" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/NOAA-ORR-ERD/PyGnome/archive/v{{ version }}.tar.gz
  sha256: ad14d089932098bcd0b063f4c08fb6a0836de4747edec0497397671f1830e03b

build:
  skip: True  # [py<39 or py>311 or python_impl == 'pypy']
  missing_dso_whitelist:
    - "*/lib_gnome.dll"         # [win]
    - "*/point_in_polygon.dll"  # [win]
  number: 0
  script: cd py_gnome && {{ PYTHON }} -m pip install ./ -vv

requirements:
  build:
    - python                              # [build_platform != target_platform]
    - cross-python_{{ target_platform }}  # [build_platform != target_platform]
    - numpy
    - cython
    - netCDF4
    - scikit-build-core
    - clang 15.*             # [osx]
    - {{ compiler('c') }}    # [not osx]
    - {{ stdlib('c') }}      # [not osx]
    - {{ compiler('cxx') }}  # [not osx]
    - make
    - cmake
  host:
    - python
    - pip
    - numpy
    - scikit-build-core
    - blosc
    - bzip2
    - curl
    - hdf4
    - hdf5
    - libcurl
    - libnetcdf
    - libaec
    - libxml2
    - libzip
    - openssl
    - zlib
    - zstd
  run:
    # Even though we have python defined in reqs->host, the windows build is
    # still complaining about it not being in reqs->run.
    - python  # [win]
    - progressbar
    - scipy
    - colander
    - gsw
    - netCDF4
    - trimesh
    - geojson
    - geopandas
    - mapbox_earcut
    - pyogrio
    - pyproj
    - shapely
    - gridded
    - pynucos
    - cell_tree2d
    - py_gd >=2.2
    - adios_db

test:
  imports:
    - gnome
  requires:
    - pytest
  commands:
    - python -c "import gnome; assert gnome.__version__ == '{{ version }}'"

about:
  home: https://github.com/NOAA-ORR-ERD/PyGnome
  license: Unlicense
  license_file: LICENSE.txt
  summary: |
    PyGNOME is a python package that encapsulates the functionality of GNOME.

  description: |
    PyGNOME is a python package that encapsulates the functionality of GNOME.
    GNOME (General NOAA Operational Modeling Environment) is a modeling tool
    developed by the National Oceanic and Atmospheric Administration (NOAA),
    Office of Response and Restoration (ORR), Emergency Response Division.
    It is designed to support oil and other hazardous material spills in the
    coastal environment, and is also a full featured, flexible particle
    tracking system, that can be used for other oceanographic transport
    applications, such as fish larvae, marine debris, etc.

extra:
  recipe-maintainers:
    - ChrisBarker-NOAA
    - JamesMakela-NOAA
    - jay-hennen
