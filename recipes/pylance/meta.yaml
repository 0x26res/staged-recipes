{% set name = "pylance" %}
{% set version = "0.9.8" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/lancedb/lance/archive/refs/tags/v{{ version }}.tar.gz
  sha256: b1152fd112214e2974280964ba934202e7e8b736cd768177d0ff25dc80663392

build:
  number: 0
  # There's a protocol buffer related error...
  # This recipe skips windows until it gets fixed...!
  # https://dev.azure.com/conda-forge/feedstock-builds/_build/results?buildId=862176&view=logs&j=240f1fee-52bc-5498-a14a-8361bde76ba0&t=7c0f8eae-6d6f-51bf-636f-73a1a7fb1bc4
  skip: true  # [py<38 or win]

requirements:
  build:
    - python                              # [build_platform != target_platform]
    # there is no cross-python for linux-64 -> win-64
    - cross-python_{{ target_platform }}  # [build_platform != target_platform and not target_platform == "win-64"]
    - crossenv                            # [build_platform != target_platform]
    - maturin >=1.4.0,<2                  # [build_platform != target_platform]
    - {{ compiler('c') }}
    - {{ compiler('rust') }}
    - cargo-bundle-licenses
    - libprotobuf
  host:
    # this is a hacky way to do cross-compilation from linux to windows
    - python              # [not (build_platform == "linux-64" and target_platform == "win-64")]
    - pip                 # [not (build_platform == "linux-64" and target_platform == "win-64")]
    - maturin >=1.4.0,<2  # [not (build_platform == "linux-64" and target_platform == "win-64")]
  run:
    - python
    - pyarrow
    - pyarrow-hotfix

test:
  imports:
    - lance
  commands:
    - pip check
  requires:
    - pip

about:
  home: https://github.com/lancedb/lancedb
  summary: python wrapper for Lance columnar format
  license: Apache-2.0
  license_file:
    - LICENSE
    - python/LICENSE

extra:
  recipe-maintainers:
    - yhori991
