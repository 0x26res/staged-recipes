context:
  name: libjaylink
  version: "0.4.0"
  build_num: 0
  so_version: "0.2.1"
  major_so_version: "0"

package:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://gitlab.zapb.de/libjaylink/libjaylink/-/archive/${{ version }}/libjaylink-${{ version }}.tar.gz
  sha256: 5557d623934a4bbc053c11f9a181375d7abeb76af910696d9e3d9b1de3bf6987
  patches:
    - if: win
      then:
        - patches/fix-socket-to-int.patch
        - patches/fix-file.io-size_t-to-uint8_t.patch

build:
  number: ${{ build_num }}

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - ninja
    - pkg-config
  host:
    - libusb
    - meson >=1.1.0

tests:
  - package_contents:
      files:
        - if: unix
          then:
            - include/libjaylink/libjaylink.h
            - include/libjaylink/version.h
            - if: linux
              then:
                - lib64/pkgconfig/libjaylink.pc
                - lib64/libjaylink.so
                - lib64/libjaylink.so.${{ so_version }}
                - lib64/libjaylink.so.${{ major_so_version }}
              else:
                - lib/pkgconfig/libjaylink.pc
                - lib/libjaylink.dylib
                - lib/libjaylink.${{ major_so_version }}.dylib
          else:
            - Library\\include\\libjaylink\\libjaylink.h
            - Library\\include\\libjaylink\\version.h
            - Library\\lib\\pkgconfig\\libjaylink.pc
            - Library\\lib\\libjaylink.dll
            - Library\\lib\\libjaylink-${{ so_version }}.dll
            - Library\\lib\\libjaylink-${{ major_so_version }}.dll


about:
  homepage: https://gitlab.zapb.de/libjaylink/libjaylink
  summary: 'libjaylink is a shared library written in C to access SEGGER J-Link.'
  description: |
    libjaylink is a shared library written in C to access SEGGER J-Link and
    compatible devices.
  license: GPL-2.0-or-later
  license_file: COPYING
  repository: https://gitlab.zapb.de/libjaylink/libjaylink

extra:
  recipe-maintainers:
    - MementoRC
  feedstock-name: libjaylink
