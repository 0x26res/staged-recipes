{% set version = "0.5.4" %}

{% set python_min = python_min | default("3.9") %}

package:
  name: python-uv
  version: {{ version }}

source:
  url: https://pypi.org/packages/source/u/uv/uv-{{ version }}.tar.gz
  sha256: cd7a5a3a36f975a7678f27849a2d49bafe7272143d938e9b6f3bf28392a3ba00
  patches:
    # replaces `maturin` with `setuptools`
    - 0000-no-rust.patch
    # provide binary path in `sys.prefix`
    - 0001-use-conda-forge-bin.patch

build:
  number: 0
  noarch: python
  script: {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation --disable-pip-version-check

requirements:
  host:
    - pip
    - python {{ python_min }}
    - setuptools
  run:
    - python >={{ python_min }}
    - uv {{ version }}.*

test:
  requires:
    - python {{ python_min }}
    - mypy
    - pip
  imports:
    - uv
    - uv._find_uv
  commands:
    - pip check
    - python -c "import uv; print(uv.find_uv_bin())"
    - uv --version
    - python -m uv --version
    - mypy -p uv

about:
  home: https://pypi.org/project/uv/
  summary: An extremely fast Python package and project manager, written in Rust.
  license: Apache-2.0 OR MIT
  license_file:
    - LICENSE-APACHE
    - LICENSE-MIT
  dev_url: https://github.com/astral-sh/uv

extra:
  recipe-maintainers:
    - bollwyvl
    # TODO: add after feedstock creation
    # - conda-forge/uv
