# this file is generated from meta.j2.yml with _update_recipe.py
{% set version = "<< version >>" %}

{% set mkdir = "mkdir -p" %}                  # [unix]
{% set copy = "cp -rv" %}                     # [unix]
{% set styles = "/share/vale/styles/" %}      # [unix]
{% set list = "find" %}                       # [unix]

{% set mkdir = "md" %}                        # [win]
{% set copy = "robocopy /s" %}                # [win]
{% set styles = "\\share\\vale\\styles\\" %}  # [win]
{% set list = "dir /s" %}                     # [win]

package:
  name: vale-packages-split
  version: {{ version }}

source:
  url: https://github.com/errata-ai/packages/archive/refs/tags/v{{ version }}.tar.gz
  sha256: << sha256_sum >>

build:
  noarch: generic
  number: << build_number >>

outputs:
  - name: vale-packages
    build:
      noarch: generic
      script:
        - python {{ RECIPE_DIR }}/_update_recipe.py --check
      ignore_run_exports:
        - python
        - python_abi
    requirements:
      build:
        - python >=3.10
        - jinja2
      run:
        - vale
        <% for name, output in outputs.items() %>
        - {{ pin_subpackage("vale-package-<< name | lower | replace("_", "-") >>", exact=True) }}
        <%- endfor %>
    test:
      source_files:
        - library.json
      files:
        - test_packages.py
      requires:
        - pytest
      commands:
        - python test_packages.py
  <% for name, output in outputs.items() %>
  - name: vale-package-<< name | lower | replace("_", "-") >>
    build:
      noarch: generic
      script:
        {% set pkg = "/pkg/<< name >>/<< name >>" %}   # [unix]
        {% set pkg = "\\pkg\\<<name>>\\<< name >>" %}  # [win]
        - {{ mkdir }} "{{ PREFIX }}{{ styles }}"
        - {{ copy }} "{{ SRC_DIR }}{{ pkg }}" "{{ PREFIX }}{{ styles }}<< name >> || exit 0"
        - {{ list }} "{{ PREFIX }}{{ styles }}<< name >>"
    <% if "meta" in output -%>
    requirements:
      run_constrained:
        - vale << output.meta.vale_version >>
    <%- else %># no `vale_version` available in `<< name >>/meta.json``<% endif %>
    test:
      commands:
        - ls -lathr "${CONDA_PREFIX}/share/vale/styles/<< name >>"  # [unix]
        - dir "%CONDA_PREFIX%\share\vale\styles\<< name >>"  # [win]
    about:
      home: << output.homepage >>
      license: MIT
      license_family: MIT
      license_file: LICENSE
      summary: |-
        << output.description >>
      dev_url: https://github.com/errata-ai/packages
  <% endfor %>

about:
  home: https://vale.sh/hub
  license: MIT
  license_family: MIT
  license_file:
    - LICENSE
  summary: A collection of pre-packaged, Vale-compatible style guides and configurations.
  description: This repository contains a library of all officially supported styles for Vale.
  dev_url: https://github.com/errata-ai/packages

extra:
  feedstock-name: vale-packages
  recipe-maintainers:
    - bollwyvl
