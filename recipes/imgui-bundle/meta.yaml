{% set version = '1.6.0' %}

package:
  name: imgui-bundle
  version: {{ version }}

source:
  # url: https://github.com/pthom/imgui_bundle/archive/refs/tags/v{{ version }}.tar.gz
  # sha256: ffae861ff9fd47c95cc56807f028d5fe78a700f92a2a43c43f31ea2358542a68
  git_url: https://github.com/pthom/imgui_bundle.git
  git_tag: v{{ version }}
  patches:
    - 0001-Do-not-force-GLFW-to-be-recompiled.patch
    - 0002-Do-not-force-static-freetype.patch
    # https://github.com/pthom/imgui_bundle/pull/284
    - 0003-Do-not-force-linking-to-non-existent-nlohmann_json-s.patch
    # Not yet, see question I asked upstream
    # https://github.com/sammycage/lunasvg/issues/198
    # But.... in either case, it is being replaced by plutovg
    # https://github.com/pthom/hello_imgui/commit/52ecf4595d7283761c9ab0c3702fa35058f2c10e
    # In a soon to be released version
    # - 0004-No-built-in-lunasvg.patch
    - 0005-Find-glfw-correctly-for-conda-forge.patch

build:
  number: 0
  # hmaarrfk -- Version 1.5.2 -- Nov 30, 2024
  # windows runs out of memory on our CIs....
  # One would think that nanobind would help reduce the memory requirements of pybind
  # https://github.com/pthom/imgui_bundle/pull/266
  # But...
  # https://github.com/pthom/imgui_bundle/pull/266#issuecomment-2489688337
  # https://github.com/wjakob/nanobind/discussions/791
  # lets revisit when we have a feedstock by adding a pagefile:
  # https://github.com/conda-forge/onnxruntime-feedstock/blob/main/conda-forge.yml#L9
  # skip: true  # [win]
  skip: true  # [py<310]
  script:
    - rm -rf external/glfw/          # [unix]
    - del /s /q external\glfw\       # [win]
    - python -m pip install . -vvv

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ compiler('c') }}
    - {{ stdlib('c') }}
    - cmake
    - ninja
    # CMake will complain if it can't find make
    - make             # [unix]
    - glad2-cmake      # [osx]
  host:
    - python
    - pip
    - glad2
    # 1.6.0 moved to nanobind
    # - pybind11 >=2.6.0
    - nanobind
    - scikit-build-core
    - glfw
    - xorg-libxrandr   # [linux]
    - xorg-libxcursor  # [linux]
    - xorg-libxi       # [linux]
    - freetype
    # Avoid downloading Qt (a dependency of opencv) for the CI
    # But it doesn't exist for Windows (yet)
    - libopencv *=headless*   # [not win]
    - libopencv
    - nlohmann_json
    - libgl-devel                        # [linux]
    - libegl-devel                       # [linux]
    - libglx-devel                       # [linux]
    # Can't unbundle yet due to incompatibility with lunasvg 3.0
    - plutovg
    # https://github.com/memononen/nanovg
    # nanovg is built using a lua build system that we don't have
    # premake4 is not available in conda-forge
    # - nanovg
  run:
    - python
    - typing_extensions
    - numpy
    - munch
    - pyglfw
    - pyopengl
    - pillow
    - pydantic

test:
  imports:
    - imgui_bundle
  requires:
    - pip
  commands:
    - pip check

about:
  home: https://github.com/pthom/imgui_bundle
  summary: 'An extensive set of ready-to-use widgets and libraries, based on ImGui. Start your first app in 5 lines of code, or less.'
  license: MIT
  license_family: MIT
  license_file: LICENSE

extra:
  recipe-maintainers:
    - hmaarrfk
