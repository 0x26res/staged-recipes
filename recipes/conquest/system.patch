From 9e9ff36bd724dc8073d7b631f037497cbfd6a5cc Mon Sep 17 00:00:00 2001
From: Jan Janssen <jan-janssen@users.noreply.github.com>
Date: Fri, 12 Jul 2024 13:59:53 +0200
Subject: [PATCH] Create system.conda.make

---
 src/Makefile           | 2 +-
 src/system/system.make | 17 +++++++++++++++++
 2 file changed, 18 insertions(+), 1 deletion(-)
 create mode 100644 src/system/system.make

diff --git a/src/system/system.make b/src/system/system.make
new file mode 100644
index 00000000..0e03b445
--- /dev/null
+++ src/system/system.make
@@ -0,0 +1,17 @@
+# This is an example system-specific makefile. You will need to adjust
+# it for the actual system you are running on.
+
+# Set compilers
+FC=mpif90
+LINKFLAGS=$(LDFLAGS) -fopenmp
+BLAS= -llapack -lblas
+SCALAPACK = -lscalapack
+XC_LIBRARY = LibXC_v5
+XC_LIB = -lxcf90 -lxc
+XC_COMPFLAGS = -I$(PREFIX)/include
+FFT_LIB=-lfftw3
+FFT_OBJ=fft_fftw3.o
+MULT_KERN = default
+DIAG_DUMMY =
+LIBS= $(XC_LIB) -lscalapack-openmpi $(BLAS) $(FFT_LIB)
+COMPFLAGS=$(FFLAGS) -O3 -fopenmp $(XC_COMPFLAGS) -fallow-argument-mismatch
diff --git a/src/Makefile b/src/Makefile
index 6f3509b2..65e81b46 100644
--- a/src/Makefile
+++ b/src/Makefile
@@ -73,7 +73,7 @@ deps.obj.inc: $(SRCS_NODS) $(SYSTEM_PATH)
 	$(ECHOSTR) "module datestamp" > datestamp.f90
 	$(ECHOSTR) "  implicit none" >> datestamp.f90
 	$(ECHOSTR) '  character(len=*), parameter :: datestr="'`date "+%Y/%m/%d at %H:%M %z"`'"' >> datestamp.f90
-	sed "s/BBB/"`git symbolic-ref HEAD | cut -b 12-`"/" $(COMMENT) | sed "s/RRR/"`git describe --tags`"/" >> datestamp.f90
+	$(ECHOSTR) $(COMMENT) >> datestamp.f90
 	$(ECHOSTR) "end module datestamp" >> datestamp.f90
 	./makedeps makedeps.txt $^
 	sed /"^mpi.o"/D makedeps.txt > deps.obj.inc
