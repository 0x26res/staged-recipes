context:
  name: loguru-cpp
  version: 2.1.1

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  # See https://github.com/emilk/loguru/issues/253
  url: https://github.com/emilk/loguru/archive/4adaa185883e3c04da25913579c451d3c32cfac1.zip
  sha256: da272cae7a177217a02fbb2622bd0ce80f3b0b6a4ffb71579c186d80ecf81f2e

build:
  number: 0
  script:
    - if: win
      then: |
        cmake -GNinja ^
            -DCMAKE_INSTALL_PREFIX=%LIBRARY_PREFIX% ^
            -DBUILD_SHARED_LIBS=ON ^
            -DLOGURU_WITH_STREAMS=ON ^
            %SRC_DIR%
        ninja install
      else: |
        cmake -GNinja \
              -DCMAKE_INSTALL_PREFIX=$PREFIX \
              -DBUILD_SHARED_LIBS=ON \
              -DLOGURU_WITH_STREAMS=ON \
              $SRC_DIR
        ninja install

requirements:
  build:
    - ${{ compiler('cxx') }}
    - ${{ stdlib("c") }}
    - cmake
    - ninja
  run_exports:
    - ${{ pin_subpackage(name, upper_bound='x.x.x') }}

tests:
  - package_contents:
      include:
        - loguru/loguru.hpp
      lib:
        - ${{ "loguru" if unix }}
      files:
        - "*/loguru.pc"
        - "*/loguru-config-version.cmake"
        - "*/loguru-config.cmake"
        - "*/loguru-targets.cmake"
        - if: not win
          then: "*/loguru-targets-release.cmake"
        - ${{ "Library/bin/logurud.dll" if win }}

about:
  summary: A lightweight C++ logging library
  license: Unlicense
  license_file: LICENSE
  homepage: https://github.com/emilk/loguru

extra:
  recipe-maintainers:
    - hadim
