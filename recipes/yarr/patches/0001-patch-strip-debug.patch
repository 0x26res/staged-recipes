From 0742baa7200ebc8ef8c359b48ca416521adb4f9f Mon Sep 17 00:00:00 2001
From: Giordon Stark <kratsg@gmail.com>
Date: Mon, 10 Feb 2025 21:52:24 -0800
Subject: [PATCH] patch

---
 CMakeLists.txt | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 9e10bc64..0979bda3 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -114,11 +114,19 @@ endif()
 set(TARGET_INSTALL_AREA ${PROJECT_SOURCE_DIR})
 set(SHARED_INSTALL_AREA ${PROJECT_SOURCE_DIR}/installed/)
 
+if(APPLE)
+  set(STRIP_DEBUG_OPTION -S)
+  set(STRIP_UNNEEDED_OPTION "")
+else()
+  set(STRIP_DEBUG_OPTION --strip-debug)
+  set(STRIP_UNNEEDED_OPTION --strip-unneeded)
+endif()
+
 function(post_build_debug_library name)
   add_custom_command(TARGET ${name}
     POST_BUILD
     COMMAND ${CMAKE_OBJCOPY} --only-keep-debug $<TARGET_FILE:${name}> ${CMAKE_CURRENT_BINARY_DIR}/lib${name}.so.debug
-    COMMAND ${CMAKE_STRIP} --strip-debug --strip-unneeded $<TARGET_FILE:${name}>
+    COMMAND ${CMAKE_STRIP} ${STRIP_DEBUG_OPTION} ${STRIP_UNNEEDED_OPTION} $<TARGET_FILE:${name}>
     COMMAND ${CMAKE_OBJCOPY} --add-gnu-debuglink=lib${name}.so.debug $<TARGET_FILE:${name}>
   )
 
@@ -131,7 +139,7 @@ function(post_build_debug_executable name)
   add_custom_command(TARGET ${name}
     POST_BUILD
     COMMAND ${CMAKE_OBJCOPY} --only-keep-debug $<TARGET_FILE:${name}> ${CMAKE_CURRENT_BINARY_DIR}/${name}.debug
-    COMMAND ${CMAKE_STRIP} --strip-debug --strip-unneeded $<TARGET_FILE:${name}>
+    COMMAND ${CMAKE_STRIP} ${STRIP_DEBUG_OPTION} ${STRIP_UNNEEDED_OPTION} $<TARGET_FILE:${name}>
     COMMAND ${CMAKE_OBJCOPY} --add-gnu-debuglink=${name}.debug $<TARGET_FILE:${name}>
   )
 
-- 
2.45.2

