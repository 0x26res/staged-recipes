package:
  name: x86_64_level-split
  version: {{ level }}

build:
  number: 0
  string: 0_{{ microarchitecture }}
  noarch: generic
  run_exports:
    - x86_64_level >={{ level }}

outputs:
  - name: x86_64_level
    requirements:
      run:
        - __archspec  1={{ microarchitecture }}

    about:
      home: https://github.com/conda-forge/x86_64_level-feedstock
      summary: 'Meta package to build conda recipes with x86_64 microarchitecture levels'
      description: |
        The meta-package x86_64_level enforces the microarchitecture in the
        user system.
    
        Note that a user would need the archspec-base conda package installed
        in the base environment where conda/mamba is run from.

        See x86_64_level_build for using this in conda recipes
      license: BSD-3-Clause
      license_file: LICENSE.txt
    
  - name: x86_64_level_build
    script: install_scripts.sh
    requirements:
      run:
        - __unix
    about:
      home: https://github.com/conda-forge/x86_64_level-feedstock
      summary: 'Meta package to build conda recipes with x86_64 microarchitecture levels'
      description: |
        Use the meta-package x86_64_level_build in host in conda recipes
        to set up the compiler flags and set up the __archspec virtual
        package in the run requirements.
    
        When building packages on CI, level=4 will not be guaranteed, so
        you can only use level<=3 to build.

        The run_exports only has a lower bound and therefore a level=2
        build can be installed on a level=3 user system. A tighter bound
        is not added because we want to be able to test both level=2 and
        level=3 on a CI machine with level=3.
        Therefore in order to prioritise the highest level, use the build
        number to prioritise the level.
      license: BSD-3-Clause
      license_file: LICENSE.txt

about:
  home: https://github.com/conda-forge/x86_64_level-feedstock
  summary: 'Meta package to build conda recipes with x86_64 microarchitecture levels'
  license: BSD-3-Clause
  license_file: LICENSE.txt

extra:
  recipe-maintainers:
    - isuruf
