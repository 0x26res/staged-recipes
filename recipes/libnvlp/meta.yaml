
{% set version = "24.7" %}
{% set arm_variant_type = "sbsa" %}

package:
  name: libnvpl-split
  version: {{ version }}

source:
  url: https://developer.download.nvidia.com/compute/nvpl/{{ version }}/local_installers/nvpl-linux-sbsa-{{ version }}.tar.gz
  sha256: 25362d64629fcf85fcb4b2ad59f7d492dc5f14dca2c9e35e822063a9b39507fc

build:
  number: 0
  # nvpl is only for ARM architecture
  skip: true  # [not aarch64]
  script:
    - cp -rv include $PREFIX
    - cp -rv lib $PREFIX

about:
  home: https://developer.nvidia.com/nvpl
  license: LicenseRef-NVIDIA-End-User-License-Agreement
  license_file: LICENSE
  license_url: https://docs.nvidia.com/nvpl/license.html
  summary: >-
    The NVIDIA Performance Libraries (NVPL) are a collection of high
    performance mathematical libraries optimized for the NVIDIA Grace Armv9.0
    architecture.
  description: >-
    The NVIDIA Performance Libraries (NVPL) are a collection of high
    performance mathematical libraries optimized for the NVIDIA Grace Armv9.0
    architecture.

    These CPU-only libraries have no dependencies on CUDA or CTK, and are drop
    in replacements for standard C and Fortran mathematical APIs allowing HPC
    applications to achieve maximum performance on the Grace platform.
  doc_url: https://docs.nvidia.com/nvpl/

extra:
  recipe-maintainers:
    - conda-forge/cuda
  feedstock-name: libnvpl

outputs:

  - name: libnvpl-dev
    requirements:
      run:
        - {{ pin_subpackage("libnvpl-blas-dev", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
        - {{ pin_subpackage("libnvpl-fft-dev", exact=True) }}
        - {{ pin_subpackage("libnvpl-lapack-dev", exact=True) }}
        - {{ pin_subpackage("libnvpl-rand-dev", exact=True) }}
        - {{ pin_subpackage("libnvpl-scalapack-dev", exact=True) }}
        - {{ pin_subpackage("libnvpl-sparse-dev", exact=True) }}
        - {{ pin_subpackage("libnvpl-tensor-dev", exact=True) }}
    about:
      summary: >-
        All NVPL files; for convenience only! Not to be used in host
        requirements for conda recipes!

  - name: libnvpl-common-dev
    files:
      - lib/cmake/nvpl/
      - lib/cmake/nvpl_common/
    test:
      commands:
        - test -f $PREFIX/lib/cmake/nvpl/nvpl-config.cmake
        - test -f $PREFIX/lib/cmake/nvpl_common/nvpl_common-config.cmake

##################### SCRIPT GENERATED BELOW

  - name: libnvpl-blas-dev
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-blas0") }}
    files:
      - include/nvpl_blas*
      - include/nvpl_blas*/**
      - lib/cmake/nvpl_blas*/**
      - lib/libnvpl_bla*.so
    requirements:
      host:
        - {{ pin_subpackage("libnvpl-blas0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run:
        - {{ pin_subpackage("libnvpl-blas0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/include/nvpl_blas.h
        - test -f $PREFIX/lib/cmake/nvpl_blas/nvpl_blas-config.cmake
        - test -f $PREFIX/lib/libnvpl_blas_core.so
        - test -f $PREFIX/lib/libnvpl_blas_ilp64_gomp.so
        - test -f $PREFIX/lib/libnvpl_blas_ilp64_seq.so
        - test -f $PREFIX/lib/libnvpl_blas_lp64_gomp.so
        - test -f $PREFIX/lib/libnvpl_blas_lp64_seq.so
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_mpich.so
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_openmpi3.so
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_openmpi4.so
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_openmpi5.so
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_mpich.so
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_openmpi3.so
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_openmpi4.so
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_openmpi5.so

  - name: libnvpl-blas0
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-blas0") }}
    files:
      - lib/libnvpl_bla*.so.*
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib('c') }}
        - arm-variant * {{ arm_variant_type }}

      host:

      run:

      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/lib/libnvpl_blas_core.so.0
        - test -f $PREFIX/lib/libnvpl_blas_core.so.0.3.0
        - test -f $PREFIX/lib/libnvpl_blas_ilp64_gomp.so.0
        - test -f $PREFIX/lib/libnvpl_blas_ilp64_gomp.so.0.3.0
        - test -f $PREFIX/lib/libnvpl_blas_ilp64_seq.so.0
        - test -f $PREFIX/lib/libnvpl_blas_ilp64_seq.so.0.3.0
        - test -f $PREFIX/lib/libnvpl_blas_lp64_gomp.so.0
        - test -f $PREFIX/lib/libnvpl_blas_lp64_gomp.so.0.3.0
        - test -f $PREFIX/lib/libnvpl_blas_lp64_seq.so.0
        - test -f $PREFIX/lib/libnvpl_blas_lp64_seq.so.0.3.0
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_mpich.so.0
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_mpich.so.0.2.0
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_openmpi3.so.0
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_openmpi3.so.0.2.0
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_openmpi4.so.0
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_openmpi4.so.0.2.0
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_openmpi5.so.0
        - test -f $PREFIX/lib/libnvpl_blacs_ilp64_openmpi5.so.0.2.0
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_mpich.so.0
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_mpich.so.0.2.0
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_openmpi3.so.0
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_openmpi3.so.0.2.0
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_openmpi4.so.0
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_openmpi4.so.0.2.0
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_openmpi5.so.0
        - test -f $PREFIX/lib/libnvpl_blacs_lp64_openmpi5.so.0.2.0

  - name: libnvpl-fft-dev
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-fft0") }}
    files:
      - include/nvpl_fft*
      - include/nvpl_fft*/**
      - lib/cmake/nvpl_fft*/**
      - lib/libnvpl_fft*.so
    requirements:
      host:
        - {{ pin_subpackage("libnvpl-fft0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run:
        - {{ pin_subpackage("libnvpl-fft0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/include/nvpl_fftw.h
        - test -f $PREFIX/lib/cmake/nvpl_fft/nvpl_fft-config.cmake
        - test -f $PREFIX/lib/libnvpl_fftw.so

  - name: libnvpl-fft0
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-fft0") }}
    files:
      - lib/libnvpl_fft*.so.*
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib('c') }}
        - arm-variant * {{ arm_variant_type }}

      host:

      run:

      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/lib/libnvpl_fftw.so.0
        - test -f $PREFIX/lib/libnvpl_fftw.so.0.3.0

  - name: libnvpl-lapack-dev
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-lapack0") }}
    files:
      - include/nvpl_lapack*
      - include/nvpl_lapack*/**
      - lib/cmake/nvpl_lapack*/**
      - lib/libnvpl_lapack*.so
    requirements:
      host:
        - {{ pin_subpackage("libnvpl-lapack0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run:
        - {{ pin_subpackage("libnvpl-lapack0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/include/nvpl_lapack.h
        - test -f $PREFIX/lib/cmake/nvpl_lapack/nvpl_lapack-config.cmake
        - test -f $PREFIX/lib/libnvpl_lapack_core.so
        - test -f $PREFIX/lib/libnvpl_lapack_ilp64_gomp.so
        - test -f $PREFIX/lib/libnvpl_lapack_ilp64_seq.so
        - test -f $PREFIX/lib/libnvpl_lapack_lp64_gomp.so
        - test -f $PREFIX/lib/libnvpl_lapack_lp64_seq.so

  - name: libnvpl-lapack0
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-lapack0") }}
    files:
      - lib/libnvpl_lapack*.so.*
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib('c') }}
        - arm-variant * {{ arm_variant_type }}

      host:
        - {{ pin_subpackage("libnvpl-blas0") }}
      run:
        - {{ pin_subpackage("libnvpl-blas0") }}
      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/lib/libnvpl_lapack_core.so.0
        - test -f $PREFIX/lib/libnvpl_lapack_core.so.0.2.3
        - test -f $PREFIX/lib/libnvpl_lapack_ilp64_gomp.so.0
        - test -f $PREFIX/lib/libnvpl_lapack_ilp64_gomp.so.0.2.3
        - test -f $PREFIX/lib/libnvpl_lapack_ilp64_seq.so.0
        - test -f $PREFIX/lib/libnvpl_lapack_ilp64_seq.so.0.2.3
        - test -f $PREFIX/lib/libnvpl_lapack_lp64_gomp.so.0
        - test -f $PREFIX/lib/libnvpl_lapack_lp64_gomp.so.0.2.3
        - test -f $PREFIX/lib/libnvpl_lapack_lp64_seq.so.0
        - test -f $PREFIX/lib/libnvpl_lapack_lp64_seq.so.0.2.3

  - name: libnvpl-rand-dev
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-rand0") }}
    files:
      - include/nvpl_rand*
      - include/nvpl_rand*/**
      - lib/cmake/nvpl_rand*/**
      - lib/libnvpl_rand*.so
    requirements:
      host:
        - {{ pin_subpackage("libnvpl-rand0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run:
        - {{ pin_subpackage("libnvpl-rand0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/include/nvpl_rand.h
        - test -f $PREFIX/lib/cmake/nvpl_rand/nvpl_rand-config.cmake
        - test -f $PREFIX/lib/libnvpl_rand.so
        - test -f $PREFIX/lib/libnvpl_rand_mt.so

  - name: libnvpl-rand0
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-rand0") }}
    files:
      - lib/libnvpl_rand*.so.*
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib('c') }}
        - arm-variant * {{ arm_variant_type }}

      host:

      run:

      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/lib/libnvpl_rand.so.0
        - test -f $PREFIX/lib/libnvpl_rand.so.0.5.0
        - test -f $PREFIX/lib/libnvpl_rand_mt.so.0
        - test -f $PREFIX/lib/libnvpl_rand_mt.so.0.5.0

  - name: libnvpl-scalapack-dev
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-scalapack0") }}
    files:
      - include/nvpl_scalapack*
      - include/nvpl_scalapack*/**
      - lib/cmake/nvpl_scalapack*/**
      - lib/libnvpl_scalapack*.so
    requirements:
      host:
        - {{ pin_subpackage("libnvpl-scalapack0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run:
        - {{ pin_subpackage("libnvpl-scalapack0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/include/nvpl_scalapack.h
        - test -f $PREFIX/lib/cmake/nvpl_scalapack/nvpl_scalapack-config.cmake
        - test -f $PREFIX/lib/libnvpl_scalapack_ilp64.so
        - test -f $PREFIX/lib/libnvpl_scalapack_lp64.so

  - name: libnvpl-scalapack0
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-scalapack0") }}
    files:
      - lib/libnvpl_scalapack*.so.*
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib('c') }}
        - arm-variant * {{ arm_variant_type }}

      host:

      run:

      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/lib/libnvpl_scalapack_ilp64.so.0
        - test -f $PREFIX/lib/libnvpl_scalapack_ilp64.so.0.2.0
        - test -f $PREFIX/lib/libnvpl_scalapack_lp64.so.0
        - test -f $PREFIX/lib/libnvpl_scalapack_lp64.so.0.2.0

  - name: libnvpl-sparse-dev
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-sparse0") }}
    files:
      - include/nvpl_sparse*
      - include/nvpl_sparse*/**
      - lib/cmake/nvpl_sparse*/**
      - lib/libnvpl_sparse*.so
    requirements:
      host:
        - {{ pin_subpackage("libnvpl-sparse0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run:
        - {{ pin_subpackage("libnvpl-sparse0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/include/nvpl_sparse.h
        - test -f $PREFIX/lib/cmake/nvpl_sparse/nvpl_sparse-config.cmake
        - test -f $PREFIX/lib/libnvpl_sparse.so

  - name: libnvpl-sparse0
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-sparse0") }}
    files:
      - lib/libnvpl_sparse*.so.*
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib('c') }}
        - arm-variant * {{ arm_variant_type }}

      host:

      run:

      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/lib/libnvpl_sparse.so.0
        - test -f $PREFIX/lib/libnvpl_sparse.so.0.3.0

  - name: libnvpl-tensor-dev
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-tensor0") }}
    files:
      - include/nvpl_tensor*
      - include/nvpl_tensor*/**
      - lib/cmake/nvpl_tensor*/**
      - lib/libnvpl_tensor*.so
    requirements:
      host:
        - {{ pin_subpackage("libnvpl-tensor0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run:
        - {{ pin_subpackage("libnvpl-tensor0", exact=True) }}
        - {{ pin_subpackage("libnvpl-common-dev", exact=True) }}
      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/include/nvpl_tensor.h
        - test -f $PREFIX/lib/cmake/nvpl_tensor/nvpl_tensor-config.cmake
        - test -f $PREFIX/lib/libnvpl_tensor.so

  - name: libnvpl-tensor0
    build:
      run_exports:
        - {{ pin_subpackage("libnvpl-tensor0") }}
    files:
      - lib/libnvpl_tensor*.so.*
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib('c') }}
        - arm-variant * {{ arm_variant_type }}
        - libgomp
      host:
        - {{ pin_subpackage("libnvpl-blas0") }}
      run:
        - {{ pin_subpackage("libnvpl-blas0") }}
      run_constrained:
        - arm-variant * {{ arm_variant_type }}
    test:
      commands:
        - test -f $PREFIX/lib/libnvpl_tensor.so.0
        - test -f $PREFIX/lib/libnvpl_tensor.so.0.2.0
