{% set pname = "aihwkit" if aihwkit_variant == 'cpu' else 'aihwkit-gpu' %}
{% set name = "aihwkit" %}
{% set version = "0.7.1" %}

package:
  name: {{ pname|lower }}
  version: {{ version }}

source:
  url: https://pypi.io/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  sha256: 2145c499ee8ade3b8645e8fc52fa7d2291881d2742728726082d291438cab452

build:
  skip: true  # [win or osx]
  skip: true  # [cuda_compiler_version in ("None", "10.2", "11.0", "11.1")]
  missing_dso_whitelist:
    - $RPATH/libtorch_python.so
    - lib/libgomp.so.1
    - lib/libopenblas.so.0
    - lib64/libc.so.6
    - lib64/ld-linux-x86-64.so.2
  number: 0

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ compiler('cuda') }}  # [cuda_compiler_version != "None"] 
  host:
    - python
    - pip
    - scikit-build
    - cmake
    - blas
    - numpy
    - pybind11
    - cudatoolkit   # [aihwkit_variant == 'gpu']
    - pytorch
  run:
    - python
    - cudatoolkit   # [aihwkit_variant == 'gpu']
    - pytorch
    - blas
    - libgomp
    - torchvision
    - requests
    - protobuf
    - scipy

test:
  imports:
    - aihwkit
    - aihwkit.simulator

about:
  home: https://github.com/IBM/aihwkit
  summary: 'A toolkit for exploring and using the capabilities of in-memory computing devices for AI.'
  license: Apache-2.0
  license_file: LICENSE.txt
  doc_url: https://aihwkit.readthedocs.io/
  dev_url: https://github.com/IBM/aihwkit
  
extra:
  recipe-maintainers:
    - kkvtran
