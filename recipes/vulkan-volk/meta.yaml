{% set version = "1.3.295" %}

package:
  # There is already a conda-forge packaged named volk
  # We use the ubuntu name vulkan-volk to avoid conflict
  # https://launchpad.net/ubuntu/+source/vulkan-volk
  name: vulkan-volk
  version: {{ version }}

source:
  url: https://github.com/zeux/volk/archive/refs/tags/{{ version }}.tar.gz
  sha256: aea9f09c49f8a4e36738003c7aa5f08f99d68b96e4028ad9fa9039d2ee9fb251
  patches:
    # Enable BUILD_SHARED_LIBS
    # https://github.com/zeux/volk/pull/201
    - 201.patch
    # Don't install volk.c
    # https://github.com/zeux/volk/pull/202
    - 202.patch

build:
  number: 0
  run_exports:
    - {{ pin_compatible('volkan-volk', max_pin='x.x.x') }}

requirements:
  build:
    - {{ compiler('c') }}
    - {{ stdlib('c') }}
    - cmake
    - ninja  # [not unix]
    - make   # [unix]
  host:
    - libvulkan-headers
    - libvulkan-loader

test:
  commands:
    - test -f ${PREFIX}/lib/libvolk${SHLIB_EXT}  # [unix]
    - if not exist %PREFIX%\\Library\\bin\\libvolk.dll exit 1  # [win]

about:
  home: https://github.com/zeux/volk
  summary: volk is a meta-loader for Vulkan.
  description: |

    It allows you to dynamically load entrypoints required to use Vulkan
    without linking to vulkan-1.dll or statically linking Vulkan loader.
    Additionally, volk simplifies the use of Vulkan extensions by automatically
    loading all associated entrypoints. Finally, volk enables loading Vulkan
    entrypoints directly from the driver which can increase performance by
    skipping loader dispatch overhead.

    volk is written in C89 and supports Windows, Linux, Android and macOS (via
    MoltenVK).

  license: MIT
  license_family: MIT
  license_file: LICENSE.md

extra:
  recipe-maintainers:
    - hmaarrfk
