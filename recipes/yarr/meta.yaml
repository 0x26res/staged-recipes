{% set name = "yarr" %}
{% set version = "1.5.2" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://gitlab.cern.ch/yarr/{{ name }}/-/archive/v{{ version }}/{{ name }}-v{{ version }}.tar.gz
  sha256: 56dd0a42f5260470239f76b89aad016913e8267fbf3e10227abf1797618de18d
  patches:
    - patches/0001-patch-strip-debug.patch
    - patches/0002-patch-dependency-resolution-for-osx.patch

build:
  skip: true  # [win, osx]
  script:
    - CXXFLAGS="${CXXFLAGS}" cmake ${CMAKE_ARGS} -DCMAKE_INSTALL_PREFIX=$PREFIX -DCMAKE_VERBOSE_MAKEFILE=ON -S . -B build
    - cmake --build build --clean-first --parallel="${CPU_COUNT}"
    - cmake --install build
    - rsync -ravz lib/ $PREFIX/lib
    - rsync -ravz bin/ $PREFIX/bin
    - ls -lhtra $PREFIX/
    - find $PREFIX -type f -iname "scanConsole"
  number: 0

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ stdlib('c') }}
    - cmake
    - make
    - rsync
  host: []
  run: []

test:
  requires:
    - {{ compiler('cxx') }}
  commands:
    - test -f $PREFIX/bin/scanConsole
    - scanConsole -h

about:
  home: https://gitlab.cern.ch/YARR/YARR
  summary: 'Yet Another Rapid Readout'
  description: |
    YARR is a readout system based around the concept of moving intelligence
    from the FPGA firmware into the host computer software. The role of the FPGA is
    the one of a reconfigurable I/O interface and not anymore the one of a hardware
    accelerator. YARR supports multiple types of FPGA platforms and readout chips.
  license: GPL-2.0-or-later
  license_family: GPL
  license_file: LICENSE.txt
  doc_url: https://yarr.web.cern.ch/yarr/
  dev_url: https://gitlab.cern.ch/YARR/YARR

extra:
  recipe-maintainers:
    - kratsg
