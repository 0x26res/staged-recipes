From d9945326a5e2d2abc22a547e42b2c021d6687874 Mon Sep 17 00:00:00 2001
From: brendanf <brendan.furneaux@gmail.com>
Date: Mon, 12 Feb 2024 12:51:27 +0200
Subject: [PATCH 2/2] windows static lib in configure

---
 configure.win    | 29 +++++++++++++++++++++++++++++
 src/Makevars.win | 18 +++---------------
 2 files changed, 32 insertions(+), 15 deletions(-)
 create mode 100644 configure.win

diff --git a/configure.win b/configure.win
new file mode 100644
index 00000000..b6a52bcb
--- /dev/null
+++ b/configure.win
@@ -0,0 +1,29 @@
+echo '$WIN = '$WIN
+if [ "$WIN" = "64" ]
+then
+    ARC="x64"
+else
+    ARC="i386"
+fi
+
+curl -sL https://github.com/shikokuchuo/rwinlib/archive/refs/tags/v1.7.0_3.5.1.zip -o nng.zip
+unzip -q nng.zip
+rm -f nng.zip
+echo
+pwd
+ls
+echo
+echo "rwinlib-1.7.0_3.5.1 :"
+ls rwinlib-1.7.0_3.5.1
+echo
+echo "rwinlib-1.7.0_3.5.1/include :"
+ls rwinlib-1.7.0_3.5.1/include
+echo
+echo "rwinlib-1.7.0_3.5.1/lib :"
+ls rwinlib-1.7.0_3.5.1/lib
+echo
+echo "rwinlib-1.7.0_3.5.1/lib/${ARC} :"
+ls rwinlib-1.7.0_3.5.1/lib/${ARC}
+
+# Success
+exit 0
diff --git a/src/Makevars.win b/src/Makevars.win
index 29130285..081150ba 100644
--- a/src/Makevars.win
+++ b/src/Makevars.win
@@ -1,15 +1,3 @@
-ifeq "$(WIN)" "64"
-    ARC="x64"
-else
-    ARC="i386"
-endif
-
-PKG_CFLAGS=-I../src-${ARC}/rwinlib-1.7.0_3.5.1/include -DNNG_STATIC_LIB $(C_VISIBILITY)
-PKG_LIBS=-L../src-${ARC}/rwinlib-1.7.0_3.5.1/lib${R_ARCH} -lnng -lmbedtls -lmbedx509 -lmbedcrypto -lbcrypt -lws2_32
-
-all: winlibs
-
-winlibs:
-	curl -sL https://github.com/shikokuchuo/rwinlib/archive/refs/tags/v1.7.0_3.5.1.zip -o nng.zip
-	unzip -q nng.zip
-	rm -f nng.zip
+PKG_CPPFLAGS=-I../rwinlib-1.7.0_3.5.1/include -DNNG_STATIC_LIB
+PKG_CFLAGS=$(C_VISIBILITY)
+PKG_LIBS=-L../rwinlib-1.7.0_3.5.1/lib/${R_ARCH} -lnng -lmbedtls -lmbedx509 -lmbedcrypto -lbcrypt -lws2_32
-- 
2.31.1

