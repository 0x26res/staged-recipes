{% set name = "minio-server" %}
{% set version = "2023-08-23T10-07-06Z" %}

package:
  name: {{ name|lower }}
  version: {{ version|replace("-", ".")|replace("T", ".")|replace("Z", "") }}

source:
  url: https://github.com/minio/minio/archive/refs/tags/RELEASE.{{ version }}.tar.gz
  sha256: 7f49d8e021cbe034ac2839e7ba5db2a0abf4b0689b316d0b3138acea20008950

build:
  number: 0
  script:
    - make build
    # see manual_licenses for licenses that are not automatically detected
    - |
      go-licenses save \
        "." \
        --save_path "${SRC_DIR}/library_licenses/" \
        --ignore github.com/cespare/xxhash/v2 \
        --ignore github.com/dchest/siphash \
        --ignore github.com/golang/snappy \
        --ignore github.com/klauspost/compress/huff0 \
        --ignore github.com/klauspost/compress/internal/cpuinfo \
        --ignore github.com/klauspost/compress/s2 \
        --ignore github.com/klauspost/compress/zstd \
        --ignore github.com/klauspost/compress/zstd/internal/xxhash \
        --ignore github.com/klauspost/cpuid/v2 \
        --ignore github.com/klauspost/reedsolomon \
        --ignore github.com/mattn/go-localereader \
        --ignore github.com/minio/colorjson \
        --ignore github.com/minio/console \
        --ignore github.com/minio/console/models \
        --ignore github.com/minio/console/restapi \
        --ignore github.com/minio/csvparser \
        --ignore github.com/minio/dperf/pkg/dperf \
        --ignore github.com/minio/filepath \
        --ignore github.com/minio/highwayhash \
        --ignore github.com/minio/kes-go \
        --ignore github.com/minio/madmin-go/v3 \
        --ignore github.com/minio/mc/cmd \
        --ignore github.com/minio/mc/pkg \
        --ignore github.com/minio/md5-simd \
        --ignore github.com/minio/minio \
        --ignore github.com/minio/minio/cmd \
        --ignore github.com/minio/pkg \
        --ignore github.com/minio/sha256-simd \
        --ignore github.com/minio/simdjson-go \
        --ignore github.com/modern-go/reflect2 \
        --ignore github.com/pierrec/lz4 \
        --ignore github.com/pierrec/lz4/v4/internal/lz4block \
        --ignore github.com/shirou/gopsutil/v3/disk \
        --ignore github.com/shirou/gopsutil/v3/host \
        --ignore github.com/zeebo/xxh3 \
        --ignore golang.org/x/crypto/argon2 \
        --ignore golang.org/x/crypto/blake2b \
        --ignore golang.org/x/crypto/chacha20poly1305 \
        --ignore golang.org/x/crypto/internal/poly1305 \
        --ignore golang.org/x/crypto/salsa20/salsa \
        --ignore golang.org/x/crypto/sha3 \
        --ignore golang.org/x/net/internal/socket \
        --ignore golang.org/x/sys/cpu \
        --ignore golang.org/x/sys/unix
    # on Unix move minio into bin
    - mkdir -p ${PREFIX}/bin  # [unix]
    - mv ./minio ${PREFIX}/bin/minio  # [unix]
    # on Windows move minio into $PREFIX
    - move ./minio ${PREFIX}/minio.exe  # [win]

requirements:
  build:
    - go >=1.16
    - go-licenses
    - make

test:
  commands:
    - minio --version

about:
  home: https://min.io
  license: AGPL-3.0-only
  license_family: AGPL
  license_file:
    - LICENSE
    - library_licenses/
    - manual_licenses/
  summary: High Performance Object Storage for AI
  description: |
    MinIO is a High Performance Object Storage released under GNU Affero General Public License v3.0.
    It is API compatible with Amazon S3 cloud storage service. Use MinIO to build high performance
    infrastructure for machine learning, analytics and application data workloads.
  doc_url: https://min.io/docs/minio
  dev_url: https://github.com/minio/minio

extra:
  recipe-maintainers:
    - kenodegard
