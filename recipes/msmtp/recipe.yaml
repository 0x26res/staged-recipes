schema_version: 1

context:
  name: msmtp
  version: 1.8.27

recipe:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://marlam.de/msmtp/releases/${{ name }}-${{ version}}.tar.xz
  sha256: 94030580a63a747faa0a3b9b1b264ae355aad33a4d94b832bfeb5b21633c965e

build:
  number: 0
  skip: win
  script:
    - autoreconf -ivf
    - ./configure --prefix=$PREFIX --datarootdir=$PREFIX --with-tls=gnutls --with-libidn
    # Conda libgsasl needs updated to v2.1 for --with-libgsasl
    - make
    - make install

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - autoconf
    - make
    - pkg-config
  host:
    - gnutls
    - libidn11
    # - libgsasl

outputs:
  - package:
      name: ${{ name }}
  - package:
      name: ${{ name }}-sendmail
    build:
      skip: win
      script:
        - ln -s msmtp $PREFIX/bin/sendmail
        - ln -s msmtp.1 $PREFIX/man/man1/sendmail.1
    requirements:
      run:
        - msmtp
    tests:
      - script:
          - sendmail --help
          - test -e $PREFIX/man/man1/sendmail.1
    about:
      summary: Use msmtp as a sendmail alternative
      desription: |
        Provides an alternative to the 'sendmail' tool. When sendmail is called
        it will call 'msmtp' instead.
      license: GPL-3.0-or-later



tests:
  - script:
      - msmtp --help
      - msmtpd --help
      - test -f $PREFIX/man/man1/msmtp.1

about:
  summary: msmtp is an SMTP client
  description: |
    In the default mode, it transmits a mail to an SMTP server which takes care
    of further delivery.

    To use this program with your mail user agent (MUA), create a configuration
    file with your mail account(s) and tell your MUA to call msmtp instead of
    /usr/sbin/sendmail.
  license: GPL-3.0-or-later
  license_file: COPYING
  homepage: https://marlam.de/msmtp/
  repository: https://git.marlam.de/gitweb/?p=msmtp.git

extra:
  recipe-maintainers:
    - blmaier
